# ADR-018: Prompts as Versioned Artifacts with Regression Tests

> **Status:** ✅ Accepted  
> **Date:** 2025-12-22  
> **Triggered By:** ADR-017 (consequence: "Prompts must also be versioned and governed")  
> **Triggers:** —

---

## Summary

* **Decision:** Prompts are stored in git with semantic versions, tested against golden sets before deployment, and pinned to execution runs via the run manifest.
* **Chosen approach:** Version control, semantic versioning, golden set testing, manifest pinning.
* **Why:** Prompt changes affect outputs. Without versioning and testing, changes are ungoverned and outputs unreproducible. Prompts are code.
* **Scope:** This ADR covers prompt lifecycle. Content is implementation detail.

---

## Context

Prompts are code:
- They determine system behavior
- Changes have consequences
- Regressions are possible
- Reproducibility requires pinning

---

## Decision

We will treat **prompts as versioned artifacts**:

### Storage structure

```
prompts/
├── extract/
│   ├── v1.0.0/
│   │   ├── prompt.txt
│   │   ├── schema.json
│   │   └── tests/
│   └── v1.1.0/
├── map/
└── design/
```

### Semantic versioning

| Change Type | Version Bump |
|-------------|--------------|
| Bug fix | Patch (1.0.0 → 1.0.1) |
| Improvement | Minor (1.0.0 → 1.1.0) |
| Schema change | Major (1.0.0 → 2.0.0) |

### Golden set testing

Before deployment:
1. Run against golden test cases
2. Outputs must match expected patterns
3. Pass schema validation
4. Not regress on previously-working cases

### Run manifest pinning

```json
{
  "run_id": "mip-20250105-143022",
  "prompt_versions": {
    "extract": "v1.2.0",
    "map": "v2.1.0"
  }
}
```

---

## Decision Rationale

> Prompt engineering without version control is prompt gambling.

---

## Consequences

### Positive Consequences

- Outputs are reproducible
- Changes are controlled
- Regressions are caught

### Negative Consequences

- Slower prompt iteration (intentionally)
- Test maintenance required

---

## References

- **Related ADRs:** ADR-017 (learning), ADR-006 (validation)
