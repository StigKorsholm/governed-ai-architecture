# ADR-010: Derive Confidence from Validator Signals, Not LLM Self-Reporting

> **Status:** ✅ Accepted  
> **Date:** 2025-12-22  
> **Triggered By:** ADR-006 (consequence: "LLM confidence is not reliable enough")  
> **Triggers:** —

---

## Summary

* **Decision:** Compute adjusted confidence from validator pass rate, evidence quality, and structural signals — not from LLM self-reported confidence scores.
* **Chosen approach:** Weighted formula combining multiple signals, calibrated against ground truth.
* **Why:** LLM confidence correlates poorly with correctness. Validator-backed confidence is operationally meaningful.
* **Scope:** This ADR covers confidence calculation philosophy. Specific weights are tunable.

---

## Context

LLMs often report high confidence for incorrect outputs.

The intuitive approach — "use the model's confidence score" — fails because:
1. Confidence is a probability distribution property, not a correctness indicator
2. Models are trained to sound confident
3. Self-reported confidence doesn't account for structural violations

---

## Decision

We will derive **confidence from validator signals**:

### Adjusted confidence formula

```
adjusted_confidence = (
    base_confidence × 0.25 +
    validator_pass_rate × 0.45 +
    evidence_quality × 0.30
)
```

### Evidence quality factors

| Factor | Contribution |
|--------|--------------|
| Column name match to BIAN | +0.20 |
| Business glossary term match | +0.20 |
| Historical mapping exists | +0.30 |
| Similar entity mapped consistently | +0.20 |
| No conflicting signals | +0.10 |

### Confidence buckets

| Bucket | Range | Action |
|--------|-------|--------|
| High | ≥ 0.85 | Auto-proceed (logged) |
| Medium | 0.70 - 0.84 | Review recommended |
| Low | < 0.70 | Review required |

### Calibration requirement

Confidence must be calibrated periodically against ground truth.

---

## Decision Rationale

> Confidence should answer "how likely is this correct?" not "how confident does the model sound?"

---

## Consequences

### Positive Consequences

- Confidence becomes operationally meaningful
- Review work is appropriately prioritized
- Calibration enables continuous improvement

### Negative Consequences

- More complex than raw passthrough
- Requires calibration effort

---

## References

- **Related ADRs:** ADR-006 (validation), ADR-007 (invariants), ADR-009 (migration thresholds)
