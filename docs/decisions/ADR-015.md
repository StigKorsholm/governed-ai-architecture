# ADR-015: Generate Diagrams Deterministically from Graph Queries

> **Status:** ✅ Accepted  
> **Date:** 2025-12-22  
> **Triggered By:** ADR-001, ADR-006 (consequence: "Diagrams must come from validated graph, not LLM narrative")  
> **Triggers:** —

---

## Summary

* **Decision:** All architecture diagrams (Mermaid, C4) are generated from Neo4j graph queries, not from LLM-generated narrative.
* **Chosen approach:** Query → Transform → Render pattern; deterministic transformation code; no LLM in diagram generation.
* **Why:** Diagrams generated from prose drift from reality. Diagrams from graph queries are reproducible by construction.
* **Scope:** This ADR covers diagram generation strategy. Templates are implementation details.

---

## Context

If diagrams are generated from prose or LLM narrative, they **drift** from the actual model.

If diagrams are generated from graph queries, they are **reproducible** and **correct by construction**.

---

## Decision

We will generate **diagrams deterministically from graph queries**:

### Query → Transform → Render

```
[Cypher Query] → [Result Set] → [Transform Code] → [Mermaid]
```

No LLM involved.

### Diagram types

| Diagram | Source Query | Format |
|---------|--------------|--------|
| Context | BoundedContexts + External | Mermaid C4 |
| BC Map | BoundedContexts + Relationships | Mermaid |
| Dependencies | TRIGGERS relationships | Mermaid |
| Migration Waves | Waves + Dependencies | Mermaid Gantt |

### Determinism guarantee

**Same graph state → Same diagram output**

---

## Decision Rationale

> A diagram that doesn't match the model is not a diagram. It's a lie.

---

## Consequences

### Positive Consequences

- Diagrams never drift from model
- Reproducible across runs
- No hallucinated relationships

### Negative Consequences

- Less "creative" layouts
- Transformation code maintenance

---

## References

- **LinkedIn Article:** [Why the Knowledge Model Must Be a Graph](https://www.linkedin.com/pulse/why-knowledge-model-must-graph-what-breaks-when-isnt-korsholm-6zzte) (2026-01-04)
- **Related ADRs:** ADR-001 (graph), ADR-006 (validation), ADR-016 (evidence)
